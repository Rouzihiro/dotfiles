#!/usr/bin/env bash
# Sets up Steam/Proton environment and X11 access

# Auto-detect DISPLAY if running in FEXBash
if [ -z "${DISPLAY:-}" ]; then
    # Use first X socket found
    if [ -e /tmp/.X11-unix/X1 ]; then
        export DISPLAY=:1
    else
        export DISPLAY=:0
    fi
fi

export SDL_VIDEODRIVER=x11
export PROTON_USE_WINED3D=1

# Steam/Proton paths
export STEAM_COMPAT_CLIENT_INSTALL_PATH="${STEAM_COMPAT_CLIENT_INSTALL_PATH:-$HOME/.steam/steam}"
export STEAM_COMPAT_DATA_PATH="${STEAM_COMPAT_DATA_PATH:-$HOME/.proton}"

# Ensure compat data exists
mkdir -p "$STEAM_COMPAT_DATA_PATH"

echo "Proton environment ready:"
echo "  DISPLAY=$DISPLAY"
echo "  SDL_VIDEODRIVER=$SDL_VIDEODRIVER"
echo "  STEAM_COMPAT_CLIENT_INSTALL_PATH=$STEAM_COMPAT_CLIENT_INSTALL_PATH"
echo "  STEAM_COMPAT_DATA_PATH=$STEAM_COMPAT_DATA_PATH"
