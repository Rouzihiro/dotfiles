#!/usr/bin/env bash
# Runs a Windows EXE via Proton inside FEXBash

set -euo pipefail

if [ $# -lt 1 ]; then
    echo "Usage: $0 <path-to-exe> [args...]"
    exit 1
fi

EXE="$1"
shift || true
ARGS="$@"

# Proton path
PROTON_PATH="$HOME/.local/share/Steam/steamapps/common/Proton 10.0/proton"

if [ ! -x "$PROTON_PATH" ]; then
    echo "Proton not found or not executable at: $PROTON_PATH"
    exit 2
fi

# Ensure X11 and Steam environment are set
export DISPLAY="${DISPLAY:-:1}"
export SDL_VIDEODRIVER=x11
export PROTON_USE_WINED3D=1
export STEAM_COMPAT_CLIENT_INSTALL_PATH="${STEAM_COMPAT_CLIENT_INSTALL_PATH:-$HOME/.steam/steam}"
export STEAM_COMPAT_DATA_PATH="${STEAM_COMPAT_DATA_PATH:-$HOME/.proton}"
mkdir -p "$STEAM_COMPAT_DATA_PATH"

# Run Proton
echo "Launching $EXE with Proton..."
exec "$PROTON_PATH" run "$EXE" $ARGS
