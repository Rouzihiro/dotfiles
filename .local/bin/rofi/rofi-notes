#!/usr/bin/env bash

DIR="$HOME/Documents/Notes"
ROFI_THEME="$HOME/.config/rofi/list.rasi"
mkdir -p "$DIR"

# Choose terminal dynamically
term="${TERMINAL:-foot}"
if ! command -v "$term" >/dev/null 2>&1; then
    term=$(command -v kitty || command -v alacritty || command -v wezterm || command -v xterm)
fi

# Get list of .md files with icon
entries=$(find "$DIR" -maxdepth 1 -type f -name "*.md" -printf "ğŸ“ %f\n" | sort)

# Add create and delete options
options="ğŸ“„ Create New Note\nğŸ—‘ï¸ Delete Note\n$entries"

# Launch rofi
selection=$(echo -e "$options" | rofi -config "$ROFI_THEME" -dmenu -i -l 20 -p "ğŸ—’ Notes")

[ -z "$selection" ] && exit

if [[ "$selection" == "ğŸ“„ Create New Note" ]]; then
    new_name=$(rofi -config "$ROFI_THEME" -dmenu -p "New note name (no .md):")
    [ -z "$new_name" ] && exit
    file="$DIR/$new_name.md"
    [ -e "$file" ] || touch "$file"
    "$term" -e nvim "$file" &
    exit
fi

if [[ "$selection" == "ğŸ—‘ï¸ Delete Note" ]]; then
    delete_target=$(find "$DIR" -maxdepth 1 -type f -name "*.md" -printf "ğŸ“ %f\n" | sort | rofi -config "$ROFI_THEME" -dmenu -i -p "ğŸ—‘ Select note to delete:")
    [ -z "$delete_target" ] && exit
    filename="${delete_target#ğŸ“ }"
    rm -f "$DIR/$filename"
    exit
fi

filename="${selection#ğŸ“ }"
"$term" -e nvim "$DIR/$filename" &
