#!/usr/bin/env bash

# Nightfox-styled bemenu wrapper
bemenu="${HOME}/.local/bin/bemenu/bm-run"
DMENU_OPTS="-l 7 -c -i -p 'Screenshot which area?'"

# Screenshot directory & filename
dir="$HOME/Pictures/screenshot"
mkdir -p "$dir"
timestamp=$(date +%Y-%m-%d-%H-%M-%S)
file="$dir/Screenshot_${timestamp}.png"

# Options
options=(
  " Capture Desktop"
  "󰩭 Capture Area"
  " Capture Window"
  " Capture in 5s"
  "󱑈 Capture in 10s"
)

# Notify function
notify_view() {
  if [[ -f "$file" ]]; then
    dunstify -u low --replace=699 "Screenshot saved and copied to clipboard."
    wl-copy < "$file"
    # optional: open with image viewer, e.g. `sxiv` or `grim` preview
    # sxiv "$file"  # uncomment if you want
  else
    dunstify -u low --replace=699 "Screenshot failed."
  fi
}

# Countdown
countdown() {
  for sec in $(seq "$1" -1 1); do
    dunstify -t 1000 --replace=699 "Taking shot in: $sec"
    sleep 1
  done
}

# Screenshot functions
shotnow() {
  flameshot full -p "$file" -c
  notify_view
}

shot5() {
  countdown 5
  flameshot full -p "$file" -c
  notify_view
}

shot10() {
  countdown 10
  flameshot full -p "$file" -c
  notify_view
}

shotwin() {
  flameshot gui -p "$file" -c
  notify_view
}

shotarea() {
  flameshot gui -p "$file" -c
  notify_view
}

# Run chosen command
run_cmd() {
  case "$1" in
    "--opt1") shotnow ;;
    "--opt2") shotarea ;;
    "--opt3") shotwin ;;
    "--opt4") shot5 ;;
    "--opt5") shot10 ;;
  esac
}

# Run menu
chosen=$(printf '%s\n' "${options[@]}" | "$bemenu" $DMENU_OPTS)
case "$chosen" in
  "${options[0]}") run_cmd --opt1 ;;
  "${options[1]}") run_cmd --opt2 ;;
  "${options[2]}") run_cmd --opt3 ;;
  "${options[3]}") run_cmd --opt4 ;;
  "${options[4]}") run_cmd --opt5 ;;
esac
