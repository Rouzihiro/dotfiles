#!/usr/bin/env bash
# DWM "mode-like" screenshot script
# Usage: ~/.dwm/screenshot-mode.sh <r|f|w>

# folder to save screenshots
DIR="$HOME/Pictures/screenshot"
mkdir -p "$DIR"
TIMESTAMP=$(date +%Y-%m-%d_%H-%M-%S)
FILE="$DIR/screenshot_$TIMESTAMP.png"

MODE="$1"

case "$MODE" in
    r)  # Region
        REGION=$(slop -f "%x,%y %wx%h") || exit
        maim -s "$REGION" | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    f)  # Fullscreen
        maim | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    w)  # Window
        WIN=$(xdotool getactivewindow) || exit
        GEOM=$(xwininfo -id "$WIN" | awk '/Absolute upper-left X/ {x=$NF} /Absolute upper-left Y/ {y=$NF} /Width/ {w=$NF} /Height/ {h=$NF} END {print x","y" "w"x"h}')
        maim -g "$GEOM" | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    *)
        echo "Usage: $0 <r|f|w>"
        exit 1
        ;;
esac
