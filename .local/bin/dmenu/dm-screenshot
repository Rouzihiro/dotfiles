#!/bin/bash

# Ensure screenshot folder exists
DIR="$HOME/Pictures/screenshot"
mkdir -p "$DIR"

# Prompt user for screenshot type
MODE=$(echo -e "Fullscreen now\nFullscreen 3sec\nSnippet now\nSnippet 3sec" | dmenu -c -l 4 -p "Select screenshot type:")

[ -z "$MODE" ] && exit 1

# Filename with timestamp
FILE="$DIR/screenshot_$(date +%Y%m%d_%H%M%S).png"

# Determine delay and type
DELAY=0
TYPE=""

case "$MODE" in
    "Fullscreen now")
        TYPE="fullscreen" ;;
    "Fullscreen 3sec")
        TYPE="fullscreen"
        DELAY=3 ;;
    "Snippet now")
        TYPE="snippet" ;;
    "Snippet 3sec")
        TYPE="snippet"
        DELAY=3 ;;
    *)
        exit 1 ;;
esac

# Optional delay
[ "$DELAY" -gt 0 ] && sleep "$DELAY"

# Take screenshot
if [ "$TYPE" = "fullscreen" ]; then
    maim "$FILE"
else
    maim -s "$FILE"
fi

# Copy to clipboard
xclip -selection clipboard -t image/png -i "$FILE"

# Notify
notify-send "Screenshot saved" "$FILE"
