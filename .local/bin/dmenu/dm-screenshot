#!/usr/bin/env bash
# DWM screenshot mode-like helper

DIR="$HOME/Pictures/screenshot"
mkdir -p "$DIR"
TIMESTAMP=$(date +%Y-%m-%d_%H-%M-%S)
FILE="$DIR/screenshot_$TIMESTAMP.png"

echo "Screenshot mode: press r (region), f (fullscreen), w (window). Timeout in 5s."

# Wait for a single key for 5 seconds
read -n 1 -t 5 key
case "$key" in
    r)
        REGION=$(slop -f "%x,%y %wx%h") || exit
        maim -s "$REGION" | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    f)
        maim | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    w)
        WIN=$(xdotool getactivewindow) || exit
        GEOM=$(xwininfo -id "$WIN" | awk '/Absolute upper-left X/ {x=$NF} /Absolute upper-left Y/ {y=$NF} /Width/ {w=$NF} /Height/ {h=$NF} END {print x","y" "w"x"h}')
        maim -g "$GEOM" | tee "$FILE" | xclip -selection clipboard -t image/png
        ;;
    *)
        echo "No valid key pressed. Exiting."
        exit 1
        ;;
esac
