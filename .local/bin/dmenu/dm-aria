#!/bin/bash

# Ask user for type
TYPE=$(echo -e "Direct link\nEmbedded video" | dmenu -c -l 2 -p "Select download type:")

# Quit if nothing selected
[ -z "$TYPE" ] && exit 1

# Ask for URL (clipboard pre-filled)
URL=$(xclip -o -selection clipboard | dmenu -c -p "Enter URL (Ctrl+V to paste):")
[ -z "$URL" ] && exit 1

if [ "$TYPE" = "Embedded video" ]; then
    # Video: use yt-dlp + aria2c
    yt-dlp --external-downloader aria2c \
           --external-downloader-args 'aria2c:-x2 -s2' \
           -o "$HOME/Downloads/%(title)s.%(ext)s" \
           "$URL" >> "$HOME/Downloads/yt-dlp.log" 2>&1 &
    notify-send "Download started (video)" "$URL"
else
    # Direct link: use aria2c directly with basename
    BASENAME=$(basename "${URL%%\?*}")
    aria2c --check-certificate=false -x2 -s2 -d "$HOME/Downloads" -o "$BASENAME" "$URL" \
           >> "$HOME/Downloads/yt-dlp.log" 2>&1 &
    notify-send "Download started (direct file)" "$BASENAME"
fi

disown
