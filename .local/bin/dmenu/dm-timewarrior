#!/bin/bash

# Timewarrior dmenu interface
OPTIONS=("â–¶ Start tracking" \
         "â¹ Stop tracking" \
         "â¸ Continue last" \
         "ğŸ“Š Today's summary" \
         "ğŸ“ˆ Weekly report" \
         "ğŸ“¤ Export today to Notes" \
         "ğŸ· Add tag" \
         "ğŸ“ Add annotation" \
         "ğŸ—‘ Delete last entry" \
         "ğŸ”„ Sync" \
         "ğŸšª Exit")

# Show dmenu and get selection
CHOICE=$(printf "%s\n" "${OPTIONS[@]}" | dmenu -i -l 12 -p "â° Timewarrior:")

# Execute based on choice
case "$CHOICE" in
    "â–¶ Start tracking")
        PROJECT=$(echo "" | dmenu -p "Project name:")
        TAGS=$(echo "" | dmenu -p "Tags (+tag1 +tag2):")
        timew start "$PROJECT" $TAGS
        notify-send "Timewarrior" "Started: $PROJECT $TAGS"
        ;;
    "â¹ Stop tracking")
        timew stop
        notify-send "Timewarrior" "Tracking stopped"
        ;;
    "â¸ Continue last")
        timew continue
        notify-send "Timewarrior" "Continued last task"
        ;;
    "ğŸ“Š Today's summary")
        SUMMARY=$(timew summary today)
        echo "$SUMMARY" | dmenu -l 20 -p "Today's time:"
        ;;
	"ğŸ“ˆ Weekly report")
    SUMMARY=$(timew summary :week)
    echo "$SUMMARY" | dmenu -l 20 -p "This week:"
    ;;
    "ğŸ“¤ Export today to Notes")
        # Create Notes directory if it doesn't exist
        mkdir -p "$HOME/Documents/Notes/"
        
        # Generate filename with date
        FILENAME="$HOME/Notes/time-tracking-$(date +%Y-%m-%d).md"
        
        # Export today's summary to markdown file
        {
            echo "# Time Tracking - $(date +%Y-%m-%d)"
            echo ""
            echo "## Summary"
            echo '```'
            timew summary today
            echo '```'
            echo ""
            echo "## Detailed Export"
            echo '```'
            timew export today
            echo '```'
        } > "$FILENAME"
        
        notify-send "Timewarrior" "Exported to: $FILENAME"
        ;;
    "ğŸ· Add tag")
        TAG=$(echo "" | dmenu -p "Add tag (+tag):")
        timew tag @1 "$TAG"
        notify-send "Timewarrior" "Added tag: $TAG"
        ;;
    "ğŸ“ Add annotation")
        NOTE=$(echo "" | dmenu -p "Add note:")
        timew annotate @1 "$NOTE"
        notify-send "Timewarrior" "Added note"
        ;;
    "ğŸ—‘ Delete last entry")
        timew delete @1
        notify-send "Timewarrior" "Deleted last entry"
        ;;
    "ğŸ”„ Sync")
        # Add your sync command here if you use timewarrior sync
        notify-send "Timewarrior" "Sync complete"
        ;;
    "ğŸšª Exit")
        exit 0
        ;;
esac
