#!/usr/bin/env bash

# Function to find the wireless interface
get_wireless_interface() {
    # Find wireless interfaces using /sys/class/net
    for interface in /sys/class/net/*; do
        if [[ -d "$interface/wireless" ]]; then
            basename "$interface"
            return 0
        fi
    done
}

# Detect wireless interface
INTERFACE=$(get_wireless_interface)

declare -A WIFI_ICONS=(
    [0]=" "     # No signal
    [1]="󰤯 "     # Very weak signal
    [2]="󰤟 "     # Weak signal
    [3]="󰤢 "     # Medium signal
    [4]="󰤥 "     # Strong signal
    [5]="󰤨 "     # Excellent signal
)

# Check if interface was found
if [[ -z "$INTERFACE" ]]; then
    exit 1
fi

if [[ "$(cat /sys/class/net/$INTERFACE/operstate)" = 'down' ]]; then
    exit 0
fi

# Get signal strength and SSID using nmcli
SIGNAL_PERCENT=$(nmcli -t -f IN-USE,SIGNAL dev wifi list | awk -F: '$1=="*" {print $2}')
SSID=$(nmcli -t -f IN-USE,SSID dev wifi list | awk -F: '$1=="*" {print $2}')
SSID=${SSID:-"Unknown"}
SIGNAL_PERCENT=${SIGNAL_PERCENT:-0}

# Map signal percentage to icons
if [[ $SIGNAL_PERCENT -ge 80 ]]; then
    ICON="${WIFI_ICONS[5]}"
elif [[ $SIGNAL_PERCENT -ge 60 ]]; then
    ICON="${WIFI_ICONS[4]}"
elif [[ $SIGNAL_PERCENT -ge 40 ]]; then
    ICON="${WIFI_ICONS[3]}"
elif [[ $SIGNAL_PERCENT -ge 20 ]]; then
    ICON="${WIFI_ICONS[2]}"
elif [[ $SIGNAL_PERCENT -ge 10 ]]; then
    ICON="${WIFI_ICONS[1]}"
else
    ICON="${WIFI_ICONS[0]}"
fi

# Output format
echo "${ICON}"
#echo "${ICON} ${SSID}"
