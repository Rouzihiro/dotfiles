command -v nvim > /dev/null 2>&1 && export MANPAGER="nvim +Man!"

find-manpage () {
    entry_raw="$(man -k . | fzf --exact --style=full)" || return 1

    manpage_name="$(echo "$entry_raw" | cut -f1 -d ' ')"
    manpage_select="$(echo "$entry_raw" | cut -f2 -d ' ' | sed 's/^(//;s/)$//')"

    man "${manpage_select}" "${manpage_name}" || return 1
}

# Check checksums recursively and as the parent directory of the file.
recurse-check-checksums () {
    checksum_type="$1"

    if [[ "$checksum_type" == "" ]]; then
        echo "Usage: recurse-check-checksums <TYPE>" >&2
        return 1
    fi

    success_count=0
    failure_count=0
    total_count=0
    while IFS= read -r line; do
        total_count=$(( ${total_count} + 1 ))

        file_name="$(basename "$line")"
        parent_dir="$(echo "$line" | sed "s/\/${file_name}\$//")"

        file_path="$(echo "$line" | sed "s/\.\//$(pwd | sed 's/\//\\\//g')\//g")"

        pushd "$parent_dir" > /dev/null 2>&1
        check_result="$("$checksum_type" -c "$file_name")"
        error_found=0
        if [[ "$check_result" == *"OK" ]]; then
            echo -e "\033[92m${file_path} - OK\033[0m"
            success_count=$(( ${success_count} + 1 ))
        else
            echo -e "\033[91m${file_path} - ERROR\033[0m"
            error_found=1
        fi
        popd > /dev/null 2>&1
        if [[ $error_found == 1 ]]; then
            failure_count=$(( ${failure_count} + 1 ))
        fi
    done < <(find . | grep "\.${checksum_type}\$")

    echo -e "\n\033[96mResult:\033[0m"
    echo -e "    \033[92mSuccess: ${success_count}/${total_count}\033[0m"
    echo -e "    \033[91mFailure: ${failure_count}/${total_count}\033[0m"

    exit_status=0
    [[ $failure_count != 0 ]] && exit_status=1

    final_verdict="\033[92mSUCCESS"
    [[ $exit_status != 0 ]] && final_verdict="\033[91mFAILURE"

    echo -e "\n\033[96mFinal Verdict: ${final_verdict}\033[0m"

    return $exit_status
}

alias recurse-check-sha512sums='recurse-check-checksums sha512sum'

alias sshfs-ro-fast='sshfs -o ro -o cache=yes -o kernel_cache -o attr_timeout=3600 -o entry_timeout=3600 -o negative_timeout=3600'


